# Validation Site

Imagine you are building news validation site to prevent fake news.
Your first story is to confirm that news from https://www.theguardian.com/tone/news is valid.

The product owner wants to start with a simple confirmation by checking other sources to confirm a news article is valid.
For the first news article on https://www.theguardian.com/tone/news your task is to search google/other resources for similar information to confirm that the article is valid. If two or more articles exist on Google or another resource then we consider the first Guardian news article to be valid.

### The project directory structure
The project has build scripts for both Maven, and follows the standard directory structure used in most Serenity projects:
```Gherkin
src
  + main
  + test
    + java                        Test runners and supporting code
    + resources
      + features                  Feature files
     + domain                  Feature file subdirectories 
             domain_by_keyword.feature
```

Serenity 2.2.13 is used to download webdriver binaries.

```Gherkin
Feature: Guardian valid news information

  Background:
    Given I navigate to guardian news page
    Then I verify the news page "News | The Guardian"
    Then I accept site cookie by clicking "Yes, I’m happy"

  @focus
  Scenario: valid news headline
    When I click on news heading 10
    Then I should be in a news article
    And I navigate to google search engine
    And I try to verify news headline on google search engine
    Then I should see a valid news title on google search list

  @focus
  Scenario: Searching for a invalid news
    When I click on news heading 5
    Then I should be in a news article
    When I set invalid news title as "Unknown news source that is being search for verification"
    And I navigate to google search engine
    And I try to verify news headline on google search engine
    Then I should see an invalid news title on google search list

```

### The Screenplay implementation
This is a sample code in the master branch uses the Screenplay pattern. The Screenplay pattern describes tests in terms of actors and the tasks they perform. Tasks are represented as objects performed by an actor, rather than methods. This makes them more flexible and composable, at the cost of being a bit more wordy. Here is an example:
```java
    @Given("{actor} navigate to guardian news page")
        public void iNavigateToGuardianNewsPage(Actor actor) {
            actor.wasAbleTo(GuardiaNewsNavigation.theGuardianNewsPage());
        }
        
        @Then("{actor} verify the news page {string}")
        public void iVerifyIAmOnnTheNewsPage(Actor actor, String title) {
            String pageTitle = BrowseTheWeb.as(actor).getTitle();
            actor.attemptsTo(
            Ensure.that(pageTitle).contains(title)
            );
		}
```

## Executing the tests
To run the sample project, you can either just run the `CucumberTestSuite` test runner class, or run either `mvn verify` or `gradle test` from the command line.

By default, the tests will run using Chrome. You can run them in Firefox by overriding the `driver` system property, e.g.
```json
$ ./mvnw clean verify -Ddriver=chrome
```

The test results will be recorded in the `target/site/serenity` directory.

## Generating the reports
Since the Serenity reports contain aggregate information about all of the tests, they are not generated after each individual test (as this would be extremenly inefficient). Rather, The Full Serenity reports are generated by the `serenity-maven-plugin`. You can trigger this by running `mvn serenity:aggregate` from the command line or from your IDE.

They reports are also integrated into the Maven build process: the following code in the `pom.xml` file causes the reports to be generated automatically once all the tests have completed when you run `mvn verify`?

```
             <plugin>
                <groupId>net.serenity-bdd.maven.plugins</groupId>
                <artifactId>serenity-maven-plugin</artifactId>
                <version>${serenity.maven.version}</version>
                <configuration>
                    <tags>${tags}</tags>
                </configuration>
                <executions>
                    <execution>
                        <id>serenity-reports</id>
                        <phase>post-integration-test</phase>
                        <goals>
                            <goal>aggregate</goal>
                        </goals>
                    </execution>
                </executions>
            </plugin>
```

## Simplified WebDriver configuration and other Serenity extras
The sample projects both use some Serenity features which make configuring the tests easier. In particular, Serenity uses the `serenity.conf` file in the `src/test/resources` directory to configure test execution options.  
### Webdriver configuration
The WebDriver configuration is managed entirely from this file, as illustrated below:
```java
webdriver {
    driver = chrome
}
headless.mode = true

chrome.switches="""--start-maximized;--test-type;--no-sandbox;--ignore-certificate-errors;
                   --disable-popup-blocking;--disable-default-apps;--disable-extensions-file-access-check;
                   --incognito;--disable-infobars,--disable-gpu"""

```